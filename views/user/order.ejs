
<%- include('../partials/user/header') %>
<section class="bg0 p-t-100 p-b-120 mainSec">
  <div class="container">
    <% if (!orders.length) { %>
    No orders found.
    <% } else { %>
    <% orders.forEach((order)=> { %>
    <div class="d-flex flex-column flex-md-row border p-3 mb-3">
      <div class="col-md-3 col-12 d-flex justify-content-center mb-5">
        <a href="/productDetail?id=<%= order.orderedProducts[0]._id %>">
          <img src="<%= order.orderedProducts[0].images[0] %>" alt="Image" height="180px" width="180px" class="img-fluid">
        </a>
      </div>
      <div class="col-md-6">
        <span class="d-block text-primary h6 text-uppercase">
          <%= order.orderedProducts[0].name %>
        </span>
        <p>
          Price: â‚¹<%= order.products.total %>,
          Quantity: <%= order.products.quantity %>,<br>
          Payment Method: <%= order.paymentMethod %><br>
          Delivery Address: <%= order.deliveryAddress.city %>,
          <%= order.deliveryAddress.pincode %>,
          <%= order.deliveryAddress.district %>,
          <%= order.deliveryAddress.state %>,
          <%= order.deliveryAddress.country %>
        </p>
        <div class="d-flex">
          <div>
            <p class="text-black">
              Order Confirmed: <%= order.orderDate.toLocaleDateString() %>
            </p>
            <p class="text-black">
              Delivery: <%= order.deliveryDate.toLocaleDateString() %><br>
              <% if (!order.products.isCancelled) { %>
                <strong>Status: 
                <% if (order.products.returnRequested==="Completed") { %>
                  <span>Product returned</span>
                <% } else { %>
                  <% if (order.status === "Delivered") { %>
                    <span class="text-success"><%= order.status %></span>
                    </p>
                  <% } else { %>
                  <span><%= order.status %></span>
                  <% } %>
                <% } %>
              </strong>
              <% } %>
            </p>
          </div>
        </div>
      </div>
      <div class="col-md-3 mt-2">
        <% if (order.products.isCancelled) { %>
        <p class="text-danger ml-3">
          Order Cancelled
        </p>
        <% } else { %>
        <% if (order.status==='Processing' ) { %>
        <p class="ml-3">
        <form action="/cancel-order" method="post" id="orders-form">
          <input type="hidden" name="orderId" value="<%= order._id %>">
          <input type="hidden" name="productId" value="<%= order.orderedProducts[0]._id %>">
          <button type="submit" class="btn btn-sm btn-outline-danger mb-3">
            Cancel
          </button>
        </form>
        </p>
        <% } else if (order.status==='Delivered' ) { %>
          <span class="text-success">Delivered</span>
        <% } %>
        <% } %>
      </div>
    </div>
    <% }) %>
    <% } %>
    <!-- Pagination controls -->

    <div class="pagination">
      <% for (let i = 1; i <= totalPages; i++) { %>
      <a href="?page=<%= i %>" class="page-link"><%= i %></a>
      <% } %>
    </div>


    <div class="row" style="margin-top: 15px;">
      <div class="col-md-6">
        <div class="row">
          <div class="col-md-6">
            <p><a href="/shop" class="btn btn-outline-primary btn-sm btn-block">Continue
                Shopping
              </a>
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Cancel Order Modal -->
<div class="modal fade" id="cancelOrderModal" tabindex="-1" role="dialog" aria-labelledby="cancelOrderModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="cancelOrderModalLabel">Confirm Cancel Order</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        Are you sure you want to cancel your order?
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Cancel</button>
        <button type="button" class="btn btn-danger" id="confirmCancelOrder">
          Cancel Order
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Footer -->
<footer class="bg3 p-t-75 p-b-32">
  <div class="container">
    <div class="row">
      <div class="col-sm-6 col-lg-3 p-b-50">
        <h4 class="stext-301 cl0 p-b-30">
          Categories
        </h4>

        <ul>
          <li class="p-b-10">
            <a href="#" class="stext-107 cl7 hov-cl1 trans-04">
              Women
            </a>
          </li>

          <li class="p-b-10">
            <a href="#" class="stext-107 cl7 hov-cl1 trans-04">
              Men
            </a>
          </li>

          <li class="p-b-10">
            <a href="#" class="stext-107 cl7 hov-cl1 trans-04">
              Shoes
            </a>
          </li>

          <li class="p-b-10">
            <a href="#" class="stext-107 cl7 hov-cl1 trans-04">
              Watches
            </a>
          </li>
        </ul>
      </div>

      <div class="col-sm-6 col-lg-3 p-b-50">
        <h4 class="stext-301 cl0 p-b-30">
          Help
        </h4>

        <ul>
          <li class="p-b-10">
            <a href="#" class="stext-107 cl7 hov-cl1 trans-04">
              Track Order
            </a>
          </li>

          <li class="p-b-10">
            <a href="#" class="stext-107 cl7 hov-cl1 trans-04">
              Returns
            </a>
          </li>

          <li class="p-b-10">
            <a href="#" class="stext-107 cl7 hov-cl1 trans-04">
              Shipping
            </a>
          </li>

          <li class="p-b-10">
            <a href="#" class="stext-107 cl7 hov-cl1 trans-04">
              FAQs
            </a>
          </li>
        </ul>
      </div>

      <div class="col-sm-6 col-lg-3 p-b-50">
        <h4 class="stext-301 cl0 p-b-30">
          GET IN TOUCH
        </h4>

        <p class="stext-107 cl7 size-201">
          Any questions? Let us know in store at 8th floor, 379 Hudson St, New York, NY 10018 or call us on (+1) 96 716 6879
        </p>

        <div class="p-t-27">
          <a href="#" class="fs-18 cl7 hov-cl1 trans-04 m-r-16">
            <i class="fa fa-facebook"></i>
          </a>

          <a href="#" class="fs-18 cl7 hov-cl1 trans-04 m-r-16">
            <i class="fa fa-instagram"></i>
          </a>

          <a href="#" class="fs-18 cl7 hov-cl1 trans-04 m-r-16">
            <i class="fa fa-pinterest-p"></i>
          </a>
        </div>
      </div>

      <div class="col-sm-6 col-lg-3 p-b-50">
        <h4 class="stext-301 cl0 p-b-30">
          Newsletter
        </h4>

        <form>
          <div class="wrap-input1 w-full p-b-4">
            <input class="input1 bg-none plh1 stext-107 cl7" type="text" name="email" placeholder="email@example.com">
            <div class="focus-input1 trans-04"></div>
          </div>

          <div class="p-t-18">
            <button class="flex-c-m stext-101 cl0 size-103 bg1 bor1 hov-btn2 p-lr-15 trans-04">
              Subscribe
            </button>
          </div>
        </form>
      </div>
    </div>

    <div class="p-t-40">
      <div class="flex-c-m flex-w p-b-18">
        <a href="#" class="m-all-1">
          <img src="images/icons/icon-pay-01.png" alt="ICON-PAY">
        </a>

        <a href="#" class="m-all-1">
          <img src="images/icons/icon-pay-02.png" alt="ICON-PAY">
        </a>

        <a href="#" class="m-all-1">
          <img src="images/icons/icon-pay-03.png" alt="ICON-PAY">
        </a>

        <a href="#" class="m-all-1">
          <img src="images/icons/icon-pay-04.png" alt="ICON-PAY">
        </a>

        <a href="#" class="m-all-1">
          <img src="images/icons/icon-pay-05.png" alt="ICON-PAY">
        </a>
      </div>

      <p class="stext-107 cl6 txt-center">
        <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
        Copyright &copy;<script>
          document.write(new Date().getFullYear());
        </script> All rights reserved | Made with <i class="fa fa-heart-o" aria-hidden="true"></i> by <a href="https://colorlib.com" target="_blank">Colorlib</a> &amp; distributed by <a href="https://themewagon.com" target="_blank">ThemeWagon</a>
        <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->

      </p>
    </div>
  </div>
</footer>

<!--===============================================================================================-->
<script src="vendor/jquery/jquery-3.2.1.min.js"></script>
<!--===============================================================================================-->
<script src="vendor/animsition/js/animsition.min.js"></script>
<!--===============================================================================================-->
<script src="vendor/bootstrap/js/popper.js"></script>
<script src="vendor/bootstrap/js/bootstrap.min.js"></script>
<!--===============================================================================================-->
<script src="vendor/select2/select2.min.js"></script>
<script>
  $(".js-select2").each(function() {
    $(this).select2({
      minimumResultsForSearch: 20,
      dropdownParent: $(this).next('.dropDownSelect2')
    });
  })
</script>
<!--===============================================================================================-->
<script src="vendor/MagnificPopup/jquery.magnific-popup.min.js"></script>
<!--===============================================================================================-->
<script src="vendor/perfect-scrollbar/perfect-scrollbar.min.js"></script>
<script>
  $('.js-pscroll').each(function() {
    $(this).css('position', 'relative');
    $(this).css('overflow', 'hidden');
    var ps = new PerfectScrollbar(this, {
      wheelSpeed: 1,
      scrollingThreshold: 1000,
      wheelPropagation: false,
    });

    $(window).on('resize', function() {
      ps.update();
    })
  });
</script>
<!--===============================================================================================-->
<script src="js/main.js"></script>

<!-- cart -->
<script>
  function updateCartItem(cartItemId, incOrDec) {
    const data = {
      type: incOrDec
    };
    $.ajax({
      url: '/update-cart/' + cartItemId,
      type: 'POST',
      data: JSON.stringify(data),
      contentType: 'application/json',
      success: function(response) {
        if (response.message !== "Insufficient stock.") {
          $('#totalPrice_' + cartItemId).text(response.totalPrice);
          $('#grandTotalPrice').text(response.grandTotal);
          $('#quantityElement_' + cartItemId).val(response.quantity);
        }
      },
      error: function(xhr, status, error) {
        console.log("uygu", status);
      }
    });
  }
</script>

</body>

</html>